--[[

	This is a hand-coded interpretation of the 1602A common 5x7 font for
	lcd displays.

	public domain
]]

require 'bit'

local font = {
	[' '] = {
		'-----',
		'-----',
		'-----',
		'-----',
		'-----',
		'-----',
		'-----',
	}, 
	['!'] = {
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'-----',
		'--X--',
		'-----',
	},
	['"'] = {
		'-X-X-',
		'-X-X-',
		'-X-X-',
		'-----',
		'-----',
		'-----',
		'-----',
	},
	['#'] = {
		'-X-X-',
		'-X-X-',
		'XXXXX',
		'-X-X-',
		'XXXXX',
		'-X-X-',
		'-X-X-',
	},
	['$'] = {
		'--X--',
		'-XXXX',
		'X-X--',
		'-XXX-',
		'--X-X',
		'XXXX-',
		'--X--',
	},
	['%'] = {
		'XX---',
		'XX--X',
		'---X-',
		'--X--',
		'-X---',
		'X--XX',
		'---XX',
	},
	['&'] = {
		'-XX--',
		'X--X-',
		'X-X--',
		'-X---',
		'X-X-X',
		'X--X-',
		'-XX-X',
	},
	['\''] = {
		'-XX--',
		'--X--',
		'-X---',
		'-----',
		'-----',
		'-----',
		'-----',
	},
	['('] = {
		'---X-',
		'--X--',
		'-X---',
		'-X---',
		'-X---',
		'--X--',
		'---X-',
	},
	[')'] = {
		'-X---',
		'--X--',
		'---X-',
		'---X-',
		'---X-',
		'--X--',
		'-X---',
	},
	['*'] = {
		'-----',
		'--X--',
		'X-X-X',
		'-XXX-',
		'X-X-X',
		'--X--',
		'-----',
	},
	['+'] = {
		'-----',
		'--X--',
		'--X--',
		'XXXXX',
		'--X--',
		'--X--',
		'-----',
	},
	[','] = {
		'-----',
		'-----',
		'-----',
		'-----',
		'-XX--',
		'--X--',
		'-X---',
	},
	['-'] = {
		'-----',
		'-----',
		'-----',
		'XXXXX',
		'-----',
		'-----',
		'-----',
	},
	['.'] = {
		'-----',
		'-----',
		'-----',
		'-----',
		'-----',
		'-XX--',
		'-XX--',
	},
	['/'] = {
		'-----',
		'----X',
		'---X-',
		'--X--',
		'-X---',
		'X----',
		'-----',
	},
	['0'] = {
		'-XXX-',
		'X---X',
		'X--XX',
		'X-X-X',
		'XX--X',
		'X---X',
		'-XXX-',
	}, 
	['1'] = {
		'--X--',
		'-XX--',
		'--X--',
		'--X--',
		'--X--',
		'-XXX-',
		'-----',
	},
	['2'] = {
		'-XXX-',
		'X---X',
		'----X',
		'---X-',
		'--X--',
		'-X---',
		'XXXXX',
	},
	['3'] = {
		'XXXXX',
		'---X-',
		'--X--',
		'---X-',
		'----X',
		'X---X',
		'-XXX-',
	},
	['4'] = {
		'---X-',
		'--XX-',
		'-X-X-',
		'X--X-',
		'XXXXX',
		'---X-',
		'---X-',
	},
	['5'] = {
		'XXXXX',
		'X----',
		'XXXX-',
		'----X',
		'----X',
		'X---X',
		'-XXX-',
	},
	['6'] = {
		'--XX-',
		'-X---',
		'X----',
		'XXXX-',
		'X---X',
		'X---X',
		'-XXX-',
	},
	['7'] = {
		'XXXXX',
		'----X',
		'---X-',
		'--X--',
		'-X---',
		'-X---',
		'-X---',
	},
	['8'] = {
		'-XXX-',
		'X---X',
		'X---X',
		'-XXX-',
		'X---X',
		'X---X',
		'-XXX-',
	},
	['9'] = {
		'-XXX-',
		'X---X',
		'X---X',
		'-XXXX',
		'----X',
		'---X-',
		'-XX--',
	},
	[':'] = {
		'-----',
		'-XX--',
		'-XX--',
		'-----',
		'-XX--',
		'-XX--',
		'-----',
	},
	[';'] = {
		'-----',
		'-XX--',
		'-XX--',
		'-----',
		'-XX--',
		'--X--',
		'-X---',
	},
	['<'] = {
		'---X-',
		'--X--',
		'-X---',
		'X----',
		'-X---',
		'--X--',
		'---X-',
	},
	['='] = {
		'-----',
		'-----',
		'XXXXX',
		'-----',
		'XXXXX',
		'-----',
		'-----',
	},
	['>'] = {
		'-X---',
		'--X--',
		'---X-',
		'----X',
		'---X-',
		'--X--',
		'-X---',
	},
	['?'] = {
		'-XXX-',
		'X---X',
		'----X',
		'---X-',
		'--X--',
		'-----',
		'--X--',
	},
	['@'] = {
		'-XXX-',
		'X---X',
		'----X',
		'-XX-X',
		'X-X-X',
		'X-X-X',
		'-XXX-',
	}, 
	['A'] = {
		'-XXX-',
		'X---X',
		'X---X',
		'X---X',
		'XXXXX',
		'X---X',
		'X---X',
	},
	['B'] = {
		'XXXX-',
		'X---X',
		'X---X',
		'XXXX-',
		'X---X',
		'X---X',
		'XXXX-',
	},
	['C'] = {
		'-XXX-',
		'X---X',
		'X----',
		'X----',
		'X----',
		'X---X',
		'-XXX-',
	},
	['D'] = {
		'XXX--',
		'X--X-',
		'X---X',
		'X---X',
		'X---X',
		'X--X-',
		'XXX--',
	},
	['E'] = {
		'XXXXX',
		'X----',
		'X----',
		'XXXX-',
		'X----',
		'X----',
		'XXXXX',
	},
	['F'] = {
		'XXXXX',
		'X----',
		'X----',
		'XXXX-',
		'X----',
		'X----',
		'X----',
	},
	['G'] = {
		'-XXX-',
		'X---X',
		'X----',
		'X-XXX',
		'X---X',
		'X---X',
		'-XXXX',
	},
	['H'] = {
		'X---X',
		'X---X',
		'X---X',
		'XXXXX',
		'X---X',
		'X---X',
		'X---X',
	},
	['I'] = {
		'-XXX-',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'-XXX-',
	},
	['J'] = {
		'--XXX',
		'---X-',
		'---X-',
		'---X-',
		'---X-',
		'X--X-',
		'-XX--',
	},
	['K'] = {
		'X---X',
		'X--X-',
		'X-X--',
		'XX---',
		'X-X--',
		'X--X-',
		'X---X',
	},
	['L'] = {
		'X----',
		'X----',
		'X----',
		'X----',
		'X----',
		'X----',
		'XXXXX',
	},
	['M'] = {
		'X---X',
		'XX-XX',
		'X-X-X',
		'X-X-X',
		'X---X',
		'X---X',
		'X---X',
	},
	['N'] = {
		'X---X',
		'X---X',
		'XX--X',
		'X-X-X',
		'X--XX',
		'X---X',
		'X---X',
	},
	['O'] = {
		'-XXX-',
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'-XXX-',
	},
	['P'] = {
		'XXXX-',
		'X---X',
		'X---X',
		'XXXX-',
		'X----',
		'X----',
		'X----',
	}, 
	['Q'] = {
		'-XXX-',
		'X---X',
		'X---X',
		'X---X',
		'X-X-X',
		'X--X-',
		'-XX-X',
	},
	['R'] = {
		'XXXX-',
		'X---X',
		'X---X',
		'XXXX-',
		'X-X--',
		'X--X-',
		'X---X',
	},
	['S'] = {
		'-XXXX',
		'X----',
		'X----',
		'-XXX-',
		'----X',
		'----X',
		'XXXX-',
	},
	['T'] = {
		'XXXXX',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
	},
	['U'] = {
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'-XXX-',
	},
	['V'] = {
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'X---X',
		'-X-X-',
		'--X--',
	},
	['W'] = {
		'X---X',
		'X---X',
		'X---X',
		'X-X-X',
		'X-X-X',
		'X-X-X',
		'-X-X-',
	},
	['X'] = {
		'X---X',
		'X---X',
		'-X-X-',
		'--X--',
		'-X-X-',
		'X---X',
		'X---X',
	},
	['Y'] = {
		'X---X',
		'X---X',
		'X---X',
		'-X-X-',
		'--X--',
		'--X--',
		'--X--',
	},
	['Z'] = {
		'XXXXX',
		'----X',
		'---X-',
		'--X--',
		'-X---',
		'X----',
		'XXXXX',
	},
	['['] = {
		'-XXX-',
		'-X---',
		'-X---',
		'-X---',
		'-X---',
		'-X---',
		'-XXX-',
	},
	['\\'] = {
		'-----',
		'X----',
		'-X---',
		'--X--',
		'---X-',
		'----X',
		'-----',
	},
	[']'] = {
		'-XXX-',
		'---X-',
		'---X-',
		'---X-',
		'---X-',
		'---X-',
		'-XXX-',
	},
	['^'] = {
		'--X--',
		'-X-X-',
		'X---X',
		'-----',
		'-----',
		'-----',
		'-----',
	},
	['_'] = {
		'-----',
		'-----',
		'-----',
		'-----',
		'-----',
		'-----',
		'XXXXX',
	},
	['`'] = {
		'-X---',
		'--X--',
		'---X-',
		'-----',
		'-----',
		'-----',
		'-----',
	}, 
	['a'] = {
		'-----',
		'-----',
		'-XXX-',
		'----X',
		'-XXXX',
		'X---X',
		'-XXXX',
	},
	['b'] = {
		'X----',
		'X----',
		'X-XX-',
		'XX--X',
		'X---X',
		'X---X',
		'XXXX-',
	},
	['c'] = {
		'-----',
		'-----',
		'-XXX-',
		'X----',
		'X----',
		'X---X',
		'-XXX-',
	},
	['d'] = {
		'----X',
		'----X',
		'-XX-X',
		'X--XX',
		'X---X',
		'X---X',
		'-XXXX',
	},
	['e'] = {
		'-----',
		'-----',
		'-XXX-',
		'X---X',
		'XXXXX',
		'X----',
		'-XXX-',
	},
	['f'] = {
		'--XX-',
		'-X--X',
		'-X---',
		'XXX--',
		'-X---',
		'-X---',
		'-X---',
	},
	['g'] = {
		'-----',
		'-XXXX',
		'X---X',
		'X---X',
		'-XXXX',
		'----X',
		'-XXX-',
	},
	['h'] = {
		'X----',
		'X----',
		'X-XX-',
		'XX--X',
		'X---X',
		'X---X',
		'X---X',
	},
	['i'] = {
		'--X--',
		'-----',
		'-XX--',
		'--X--',
		'--X--',
		'--X--',
		'-XXX-',
	},
	['j'] = {
		'---X-',
		'-----',
		'--XX-',
		'---X-',
		'---X-',
		'X--X-',
		'-XX-',
	},
	['k'] = {
		'X----',
		'X----',
		'X--X-',
		'X-X--',
		'XX---',
		'X-X--',
		'X--X-',
	},
	['l'] = {
		'-XX--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'-XXX-',
	},
	['m'] = {
		'-----',
		'-----',
		'XX-X-',
		'X-X-X',
		'X-X-X',
		'X---X',
		'X---X',
	},
	['n'] = {
		'-----',
		'-----',
		'X-XX-',
		'XX--X',
		'X---X',
		'X---X',
		'X---X',
	},
	['o'] = {
		'-----',
		'-----',
		'-XXX-',
		'X---X',
		'X---X',
		'X---X',
		'-XXX-',
	},
	['p'] = {
		'-----',
		'-----',
		'XXXX-',
		'X---X',
		'XXXX-',
		'X----',
		'X----',
	}, 
	['q'] = {
		'-----',
		'-----',
		'-XX-X',
		'X--XX',
		'-XXXX',
		'----X',
		'----X',
	},
	['r'] = {
		'-----',
		'-----',
		'X-XX-',
		'XX--X',
		'X----',
		'X----',
		'X----',
	},
	['s'] = {
		'-----',
		'-----',
		'-XXX-',
		'X----',
		'-XXX-',
		'----X',
		'XXXX-',
	},
	['t'] = {
		'-X---',
		'-X---',
		'XXX--',
		'-X---',
		'-X---',
		'-X--X',
		'--XX-',
	},
	['u'] = {
		'-----',
		'-----',
		'X---X',
		'X---X',
		'X---X',
		'X--XX',
		'-XX-X',
	},
	['v'] = {
		'-----',
		'-----',
		'X---X',
		'X---X',
		'X---X',
		'-X-X-',
		'--X--',
	},
	['w'] = {
		'-----',
		'-----',
		'X---X',
		'X---X',
		'X-X-X',
		'X-X-X',
		'-X-X-',
	},
	['x'] = {
		'-----',
		'-----',
		'X---X',
		'-X-X-',
		'--X--',
		'-X-X-',
		'X---X',
	},
	['y'] = {
		'-----',
		'-----',
		'X---X',
		'X---X',
		'-XXXX',
		'----X',
		'-XXX-',
	},
	['z'] = {
		'-----',
		'-----',
		'XXXXX',
		'---X-',
		'--X--',
		'-X---',
		'XXXXX',
	},
	['{'] = {
		'---X-',
		'--X--',
		'--X--',
		'-X---',
		'--X--',
		'--X--',
		'---X-',
	},
	['|'] = {
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
		'--X--',
	},
	['}'] = {
		'-X---',
		'--X--',
		'--X--',
		'---X-',
		'--X--',
		'--X---',
		'-X---',
	},
	['~'] = {
		'-----',
		'-----',
		'-----',
		'-XX-X',
		'X--X-',
		'-----',
		'-----',
	},
}

--[[
	output this font into a standard format: (.bcf)

	XXXX XX   X  X  ~~ ~~ ~~
	BCFF -1   -2 -3 -5 -6 
	BCFV -1   -2 -3 -4 -5 -6

	BCFF: Binary Character Font Fixed
	BCFV: Binary Character Font Variable (width)

	-1: num characters contained, lower byte first, two bytes (65535 characters allowed)
	-2: width of each character in bits
	-3: height of each character in lines
	-4: one byte per character, width of each for variable width fonts
	-5: each character stored, UTF-8 encoded in same order as bit data that follows
	-6: character bits, for each character in order, as follows;
		width bits to bytes (round up) x lines bytes per character
		lines top to bottom, lower bytes first


	Some simple file format limitations:
		255 width, 255 height character bitmaps
		65535 characters in total
]]

local ccnt = 0
local fw = 5
local fh = 7
local fwb = math.floor(fw / 8) + 1

for k, v in pairs(font) do
	-- count contained characters
	ccnt = ccnt + 1
end

f = io.open("min5x7.bin", "wb")

f:write('BCFF')
f:write(string.format("%c%c", bit.band(ccnt, 0xFF), bit.rshift(bit.band(ccnt, 0xFF00), 8)))
f:write(string.format("%c", bit.band(fw, 0xFF)))
f:write(string.format("%c", bit.band(fh, 0xFF)))

for k, v in pairs(font) do
	-- the character code
	f:write(k)	
end

for k, v in pairs(font) do
	-- the character bits
	for l = 1, fh, 1 do
		for b = 1, fwb, 1 do
			local pos = (b - 1) * 8
			local bp = 0
			local byte = 0
			while pos < fw and bp < 8 do
				if v[l]:sub(pos + 1, pos + 1) == 'X' then
					byte = byte + bit.lshift(1, bp)
				end
				pos = pos + 1
				bp = bp + 1
			end
			f:write(string.format("%c", bit.band(byte, 0xFF)))
		end
	end
end

f:close()
